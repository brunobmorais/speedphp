<style>
    .custom-input-group {
        display: flex;
        align-items: center;
        border: 2px solid #efe9f9;
        /* Cor padrão da borda */
        border-radius: 0.375rem;
        /* Borda arredondada */
        background-color: #fff;
        /* Fundo branco */
    }

    .custom-input-group:focus-within {
        border-color: var(--mycolor-primary);
    }

    .custom-input-group input {
        text-align: center;
        border: none;
        /* Remove a borda padrão do input */
        outline: none;
        /* Remove o contorno padrão */
        flex: 1;
        /* Faz o input ocupar o espaço restante */
    }

    .custom-input-group span {
        padding: 0.375rem 0.3rem;
        /* Espaçamento interno do rótulo */
        background-color: transparent;
        /* Fundo transparente para uniformidade */
        border-left: none;
        /* Remove a borda entre o input e o rótulo */
        color: rgb(110, 110, 139);
    }

    .form-control:focus {
        border: none;
    }

    .tituloCadaCard {
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    #paceAtleta {
        background-color: var(--mycolor-primary);
        color: #fff;
        border-radius: 12px;
        text-align: center;
    }

    .paceDestaque {
        font-size: 1.5em;
    }

    #divProjecao {
        display: none;
    }
</style>

<div class="container p-0">
    <div class="row">

        <div class="col-12 p-0 pe-lg-3">

            <div class="bg-white rounded-3 mt-4 cadaDivPaginaEvento p-1 p-lg-3">
                <h6 class="text-uppercase border-bottom border-1 p-1 p-lg-2 mb-3 tituloCadaCard">
                    <span class="mdi mdi-calculator mdi-24px p-0"></span>
                    Calculadora de Pace
                </h6>
                <div class="p-0">
                    <form>
                        <div class="row">
                            <div class="col-12">
                                <div class="col-12 float-start p-1">
                                    <label for="basic-url" class="form-label">Distância</label>
                                    <div class="custom-input-group">
                                        <input type="text" name="distancia" id="distancia"
                                            class="form-control p-0 form-control-lg" placeholder="00" aria-label="00">
                                        <span>kms</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="col-4 float-start p-1">
                                    <label for="basic-url" class="form-label">Tempo</label>
                                    <div class="custom-input-group">
                                        <input type="number" name="horas" id="horas"
                                            class="form-control p-0 form-control-lg" placeholder="00" aria-label="00">
                                        <span>hrs</span>
                                    </div>
                                </div>
                                <div class="col-4 float-start p-1">
                                    <label for="basic-url" class="form-label">-</label>
                                    <div class="custom-input-group">
                                        <input type="number" name="minutos" id="minutos"
                                            class="form-control p-0 form-control-lg" placeholder="00" aria-label="00">
                                        <span>min</span>
                                    </div>
                                </div>
                                <div class="col-4 float-start p-1">
                                    <label for="basic-url" class="form-label">-</label>
                                    <div class="custom-input-group">
                                        <input type="number" name="segundos" id="segundos"
                                            class="form-control p-0 form-control-lg" placeholder="00" aria-label="00">
                                        <span>seg</span>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class="row">
                            <div class="col-12 py-3">
                                <p class="p-2" id="paceAtleta">
                                    Insira a distância e o tempo da sua corrida.
                                </p>
                            </div>
                            <div class="col-12" id="divProjecao">
                                <h5 class="p-1 mt-2">Projeção para outras distâncias
                                    <span tabindex="0" class="mdi mdi-information-slab-circle-outline cursor-pointer" role="button"
                                    data-bs-toggle="popover" data-bs-trigger="focus" data-bs-html="true" data-bs-content="
                                        <p>O cálculo representa uma estimativa feita utilizando a fórmula de Riegel.</p>
                                        <p>Esta fórmula é amplamente utilizada para prever tempos de corrida.</p>
                                        <p><em>Lembre-se:</em> esse cálculo representa uma estimativa.</p>
                                        <p>Para uma previsão mais precisa, é importante considerar fatores individuais, como nível de treinamento, condições físicas e características do percurso.</p>
                                    ">
                                </span>

                                </h5>
                                <table class="table table-striped">
                                    <tr>
                                        <th>Insira os valores acima!</th>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="modalProjecaoPace" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Sobre a previsão de paces</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                O calculo representa uma estimativa feita utilizando a fórmula de Riegel.

                Esta fórmula é amplamente utilizada para prever tempos de corrida.

                Basicamente, usa-se um pace já conhecido, e o relaciona com um fator que tenta representar a fadiga
                que se teria em outras distâncias.

                Lembre-se: esse calculo representa uma estimativa.

                Para uma previsão mais precisa, é importante considerar fatores individuais, como nível de
                treinamento, condições físicas e características do percurso.

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Entendido!</button>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Seleciona os inputs
        const distanciaInput = document.getElementById("distancia");
        const horasInput = document.getElementById("horas");
        const minutosInput = document.getElementById("minutos");
        const segundosInput = document.getElementById("segundos");
        const tabela = document.querySelector("table");
        const divPaceAtleta = document.getElementById("paceAtleta");
        const divProjecao = document.getElementById("divProjecao");

        // Distâncias para projeção e seus respectivos nomes
        const distanciasProjecao = [
            { km: 42.195, nome: "Maratona" },
            { km: 21.1, nome: "Meia Maratona" },
            { km: 16, nome: "10 Milhas" },
            { km: 10, nome: "" },
            { km: 8, nome: "5 Milhas" },
            { km: 5, nome: "" },
            { km: 3, nome: "" },
            { km: 1, nome: "" }
        ];

        // Expoente otimizado baseado na fórmula de Riegel
        const k = 1.072;

        // Função para validar e normalizar os inputs
        function validarInputs() {
            // Permitir distâncias quebradas (ex.: 5,4 ou 5.4) e remover entradas inválidas
            distanciaInput.value = distanciaInput.value
                .replace(/,/g, ".") // Substituir vírgulas por pontos
                .replace(/[^0-9.]/g, "") // Remover caracteres não numéricos exceto ponto
                .replace(/(\..*?)\..*/g, "$1"); // Garantir no máximo um ponto decimal

            minutosInput.value = Math.min(59, Math.max(0, parseInt(minutosInput.value) || 0));
            segundosInput.value = Math.min(59, Math.max(0, parseInt(segundosInput.value) || 0));
            horasInput.value = Math.max(0, parseInt(horasInput.value) || 0);
        }

        // Função para calcular o pace (tempo médio por km)
        function calcularPace(tempoTotalMinutos, distancia) {
            if (distancia <= 0 || tempoTotalMinutos <= 0) return "00:00";

            const pace = tempoTotalMinutos / distancia;
            const paceMin = Math.floor(pace);
            const paceSeg = Math.round((pace - paceMin) * 60);
            return `${paceMin}:${paceSeg.toString().padStart(2, "0")}`;
        }

        // Função para calcular e atualizar a tabela
        function atualizarTabela() {
            validarInputs();

            const distanciaUsuario = parseFloat(distanciaInput.value) || 0;
            const horas = parseInt(horasInput.value) || 0;
            const minutos = parseInt(minutosInput.value) || 0;
            const segundos = parseInt(segundosInput.value) || 0;

            const tempoTotalMinutosUsuario = horas * 60 + minutos + segundos / 60;

            if (distanciaUsuario > 0 && tempoTotalMinutosUsuario > 0) {
                let tabelaHTML = `
                    <thead>
                        <tr>
                            <th>Distância</th>
                            <th>Tempo</th>
                            <th>Pace</th>
                            <th>Velocidade</th>
                        </tr>
                    </thead>
                    <tbody>
                `;

                // Adicionar o pace do usuário como a primeira linha da tabela
                const paceUsuario = calcularPace(tempoTotalMinutosUsuario, distanciaUsuario);
                const velocidadeUsuario = ((distanciaUsuario / tempoTotalMinutosUsuario) * 60).toFixed(2);

                divPaceAtleta.innerHTML = `
                    Seu pace foi de <span class="paceDestaque">${paceUsuario}</span> min/km e sua velocidade <span class="paceDestaque">${velocidadeUsuario}</span> km/h.
                `;

                // Preencher a tabela com as projeções
                distanciasProjecao.forEach(({ km, nome }) => {
                    const tempoPrevisto = tempoTotalMinutosUsuario * (km / distanciaUsuario) ** k;
                    const tHoras = Math.floor(tempoPrevisto / 60);
                    const tMinutos = Math.floor(tempoPrevisto % 60);
                    const tSegundos = Math.round((tempoPrevisto % 1) * 60);
                    const tempoFormatado = `${tHoras.toString().padStart(2, "0")}:${tMinutos.toString().padStart(2, "0")}:${tSegundos.toString().padStart(2, "0")}`;

                    const paceFormatado = calcularPace(tempoPrevisto, km);
                    const velocidadeFormatada = ((km / tempoPrevisto) * 60).toFixed(2);

                    tabelaHTML += `
                        <tr>
                            <td><strong>${km} km${nome ? " - " + nome : ""}</strong></td>
                            <td>${tempoFormatado}</td>
                            <td>${paceFormatado} min/km</td>
                            <td>${velocidadeFormatada} km/h</td>
                        </tr>
                    `;
                });

                tabelaHTML += "</tbody>";
                tabela.innerHTML = tabelaHTML;
                divProjecao.style.display = "block";
            } else {
                tabela.innerHTML = `
                    <tr>
                        <th>Insira os valores acima!</th>
                    </tr>
                `;
            }
        }

        [distanciaInput, horasInput, minutosInput, segundosInput].forEach(input => {
            input.addEventListener("input", atualizarTabela);
        });

        atualizarTabela();
    });
    document.querySelector('[data-bs-target="#modalProjecaoPace"]').addEventListener('click', function (event) {
        event.preventDefault(); // Impede comportamentos padrão
    });
</script>